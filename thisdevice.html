<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Scontrino â€“ YHAZ Device Info</title>
  <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: 'VT323', monospace;
      background: #fff;
      color: #000;
      margin: 0;
      padding: 2rem 1rem;
      display: flex;
      justify-content: center;
      transition: background 0.3s, color 0.3s;
    }

    @media (prefers-color-scheme: dark) {
      body {
        background: #111;
        color: #fff;
      }
    }

    .receipt {
      background: inherit;
      padding: 1.5rem;
      width: 340px;
      text-align: left;
    }

    h1 {
      font-size: 1.8rem;
      margin: 0 0 1rem 0;
      text-align: center;
      padding-bottom: 0.5rem;
    }

    .section {
      margin: 1.2rem 0;
      border-top: 1px dashed currentColor;
      padding-top: 0.5rem;
    }

    .section-title {
      font-weight: bold;
      margin-bottom: 0.5rem;
      font-size: 1.2rem;
    }

    ul {
      list-style: none;
      padding: 0;
      margin: 0.5rem 0;
    }

    li {
      padding: 0.3rem 0;
      font-size: 1.1rem;
      display: flex;
      justify-content: space-between;
    }

    .footer {
      margin-top: 1rem;
      padding-top: 0.5rem;
      text-align: center;
      font-size: 0.9rem;
    }

    button {
      display: block;
      margin: 1rem auto;
      padding: 0.4rem 0.8rem;
      font-size: 1rem;
      background: transparent;
      border: 1px solid currentColor;
      cursor: pointer;
    }

    button:hover {
      background: currentColor;
      color: inherit;
      mix-blend-mode: difference;
    }

    .loading {
      opacity: 0.7;
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="receipt">
     <button class="btn" onclick="window.location.href='index.html'">HOME</button>
    <h1>ðŸ“Ÿ YHAZ Scontrino</h1>
    <div id="infoContainer"></div>
    
    <div class="footer">-- Grazie per aver usato YHAZ --</div>
  </div>

  <script>
    const infoContainer = document.getElementById('infoContainer');
    const data = {
      system: {},
      network: {},
      media: {},
      storage: {},
      location: {},
      battery: {}
    };

    function createSection(title, id) {
      const section = document.createElement('div');
      section.className = 'section';
      section.innerHTML = `
        <div class="section-title">${title}</div>
        <ul id="${id}"></ul>
      `;
      infoContainer.appendChild(section);
      return document.getElementById(id);
    }

    function addItem(section, label, value, category = 'system') {
      data[category][label] = value;
      const li = document.createElement('li');
      li.innerHTML = `<span>${label}</span><span>${value}</span>`;
      section.appendChild(li);
    }

    function addLoadingItem(section, label) {
      const li = document.createElement('li');
      li.innerHTML = `<span>${label}</span><span class="loading">Rilevamento...</span>`;
      section.appendChild(li);
      return li;
    }

    function exportPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ unit: "pt", format: "a4" });

      let y = 40;
      doc.setFont("courier", "normal");
      doc.setFontSize(12);
      doc.text("ðŸ“Ÿ YHAZ SCONTRINO", 200, y, { align: "center" });
      y += 20;

      // Funzione per aggiungere una sezione al PDF
      function addSectionToPdf(sectionTitle, sectionData) {
        if (Object.keys(sectionData).length > 0) {
          doc.setFontSize(11);
          doc.text(sectionTitle, 40, y);
          y += 15;
          doc.setFontSize(10);
          
          Object.entries(sectionData).forEach(([label, value]) => {
            doc.text(`${label}: ${value}`, 45, y);
            y += 14;
          });
          y += 5;
        }
      }

      addSectionToPdf("SISTEMA", data.system);
      addSectionToPdf("RETE", data.network);
      addSectionToPdf("MULTIMEDIA", data.media);
      addSectionToPdf("ARCHIVIAZIONE", data.storage);
      addSectionToPdf("POSIZIONE", data.location);
      addSectionToPdf("BATTERIA", data.battery);

      y += 10;
      doc.setFontSize(10);
      doc.text("-- Grazie per aver usato YHAZ --", 200, y, { align: "center" });

      doc.save("yhaz_device_info.pdf");
    }

    function getSystemInfo() {
      const systemList = createSection("SISTEMA", "systemList");
      const ua = navigator.userAgent;
      const deviceType = /Mobi|Android/i.test(ua) ? 'Mobile' : 'Desktop';
      const os = (() => {
        if (/Windows/i.test(ua)) return 'Windows';
        if (/Mac/i.test(ua)) return 'macOS';
        if (/Linux/i.test(ua)) return 'Linux';
        if (/Android/i.test(ua)) return 'Android';
        if (/iPhone|iPad/i.test(ua)) return 'iOS';
        return 'Sconosciuto';
      })();
      const arch = navigator.userAgent.includes("WOW64") || navigator.userAgent.includes("Win64") || navigator.userAgent.includes("x86_64") ? "64-bit" : "32-bit";
      const browser = (() => {
        if (/Edg/i.test(ua)) return 'Edge';
        if (/Chrome/i.test(ua)) return 'Chrome';
        if (/Safari/i.test(ua) && !/Chrome/i.test(ua)) return 'Safari';
        if (/Firefox/i.test(ua)) return 'Firefox';
        if (/Opera|OPR/i.test(ua)) return 'Opera';
        return 'Sconosciuto';
      })();

      // Informazioni base
      addItem(systemList, "OS", os);
      addItem(systemList, "Architettura", arch);
      addItem(systemList, "Dispositivo", deviceType);
      addItem(systemList, "Browser", browser);
      addItem(systemList, "User Agent", ua);
      addItem(systemList, "Piattaforma", navigator.platform || "N/A");
      addItem(systemList, "Lingua", navigator.language);
      addItem(systemList, "Lingue", navigator.languages.join(", "));
      addItem(systemList, "Timezone", Intl.DateTimeFormat().resolvedOptions().timeZone);
      addItem(systemList, "Offset UTC", `${new Date().getTimezoneOffset()} min`);
      addItem(systemList, "Risoluzione", `${window.screen.width}x${window.screen.height}`);
      addItem(systemList, "PixelRatio", window.devicePixelRatio);
      addItem(systemList, "CPU Cores", navigator.hardwareConcurrency || "N/A");
      addItem(systemList, "RAM", navigator.deviceMemory ? navigator.deviceMemory + " GB" : "N/A");
      addItem(systemList, "Cookies", navigator.cookieEnabled ? "SÃ¬" : "No");
      addItem(systemList, "Online", navigator.onLine ? "SÃ¬" : "No");
      addItem(systemList, "Touch", 'ontouchstart' in window ? "SÃ¬" : "No");
      
      // Informazioni GPU e WebGL
      try {
        const canvas = document.createElement('canvas');
        const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
        if (gl) {
          const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
          if (debugInfo) {
            const vendor = gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL);
            const renderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
            addItem(systemList, "GPU Vendor", vendor);
            addItem(systemList, "GPU Renderer", renderer);
          }
        }
      } catch (e) {
        addItem(systemList, "WebGL", "Non supportato");
      }

      // Supporto per JavaScript
      addItem(systemList, "JavaScript", "Abilitato");
      addItem(systemList, "Cookie", navigator.cookieEnabled ? "Abilitati" : "Disabilitati");
      addItem(systemList, "Do Not Track", navigator.doNotTrack || "Non impostato");
    }

    function getNetworkInfo() {
      const networkList = createSection("RETE", "networkList");
      
      // Informazioni base sulla connessione
      addItem(networkList, "Connessione", navigator.onLine ? "Online" : "Offline");
      
      // Network Information API (se supportata)
      if ('connection' in navigator) {
        const conn = navigator.connection;
        if (conn) {
          addItem(networkList, "Tipo connessione", conn.type || "N/A");
          addItem(networkList, "VelocitÃ  efficace", conn.effectiveType || "N/A");
          if (conn.downlink) addItem(networkList, "VelocitÃ  downlink", `${conn.downlink} Mbps`);
          if (conn.rtt) addItem(networkList, "RTT", `${conn.rtt} ms`);
          if (conn.saveData) addItem(networkList, "Risparmio dati", conn.saveData ? "Attivo" : "Non attivo");
        }
      }
      
      // Ottieni IP pubblico
      const ipItem = addLoadingItem(networkList, "IP Pubblico");
      fetch('https://api.ipify.org?format=json')
        .then(response => response.json())
        .then(data => {
          ipItem.querySelector('span:last-child').textContent = data.ip;
          ipItem.querySelector('span:last-child').classList.remove('loading');
          addItem(networkList, "IP Pubblico", data.ip, 'network');
        })
        .catch(() => {
          ipItem.querySelector('span:last-child').textContent = "Non disponibile";
          ipItem.querySelector('span:last-child').classList.remove('loading');
        });
    }

    function getMediaInfo() {
      const mediaList = createSection("MULTIMEDIA", "mediaList");
      
      // Supporto codec video
      const video = document.createElement('video');
      addItem(mediaList, "H.264", video.canPlayType('video/mp4; codecs="avc1.42E01E"') ? "SÃ¬" : "No");
      addItem(mediaList, "WebM", video.canPlayType('video/webm; codecs="vp8, vorbis"') ? "SÃ¬" : "No");
      addItem(mediaList, "AV1", video.canPlayType('video/webm; codecs="av01.0.05M.08"') ? "SÃ¬" : "No");
      addItem(mediaList, "HEVC", video.canPlayType('video/mp4; codecs="hvc1.1.L120"') ? "SÃ¬" : "No");
      
      // Supporto codec audio
      const audio = document.createElement('audio');
      addItem(mediaList, "MP3", audio.canPlayType('audio/mpeg') ? "SÃ¬" : "No");
      addItem(mediaList, "AAC", audio.canPlayType('audio/aac') ? "SÃ¬" : "No");
      addItem(mediaList, "OGG Vorbis", audio.canPlayType('audio/ogg; codecs="vorbis"') ? "SÃ¬" : "No");
      addItem(mediaList, "WAV", audio.canPlayType('audio/wav; codecs="1"') ? "SÃ¬" : "No");
      addItem(mediaList, "Opus", audio.canPlayType('audio/ogg; codecs="opus"') ? "SÃ¬" : "No");
      
      // WebRTC
      addItem(mediaList, "WebRTC", !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia) ? "Supportato" : "Non supportato");
    }

    function getStorageInfo() {
      const storageList = createSection("ARCHIVIAZIONE", "storageList");
      
      // Storage stimato
      if ('storage' in navigator && 'estimate' in navigator.storage) {
        navigator.storage.estimate().then(estimate => {
          const used = (estimate.usage / (1024 * 1024)).toFixed(2);
          const quota = (estimate.quota / (1024 * 1024)).toFixed(2);
          addItem(storageList, "Spazio usato", `${used} MB`, 'storage');
          addItem(storageList, "Spazio totale", `${quota} MB`, 'storage');
          addItem(storageList, "Percentuale uso", `${((estimate.usage / estimate.quota) * 100).toFixed(2)}%`, 'storage');
        }).catch(() => {
          addItem(storageList, "Storage API", "Non supportata", 'storage');
        });
      } else {
        addItem(storageList, "Storage API", "Non supportata", 'storage');
      }
      
      // Persistent Storage
      if ('storage' in navigator && 'persist' in navigator.storage) {
        navigator.storage.persist().then(persistent => {
          addItem(storageList, "Storage persistente", persistent ? "SÃ¬" : "No", 'storage');
        });
      }
      
      // LocalStorage e SessionStorage
      addItem(storageList, "LocalStorage", typeof(Storage) !== "undefined" ? "Supportato" : "Non supportato", 'storage');
      addItem(storageList, "SessionStorage", typeof(Storage) !== "undefined" ? "Supportato" : "Non supportato", 'storage');
      addItem(storageList, "IndexedDB", typeof indexedDB !== "undefined" ? "Supportato" : "Non supportato", 'storage');
    }

    function getLocationInfo() {
      const locationList = createSection("POSIZIONE", "locationList");
      
      // Geolocalizzazione
      if ('geolocation' in navigator) {
        addItem(locationList, "Geolocalizzazione", "Supportata", 'location');
        
        // Prova a ottenere la posizione (solo con permesso)
        const locationItem = addLoadingItem(locationList, "Posizione attuale");
        navigator.geolocation.getCurrentPosition(
          position => {
            const lat = position.coords.latitude.toFixed(6);
            const lon = position.coords.longitude.toFixed(6);
            locationItem.querySelector('span:last-child').textContent = `${lat}, ${lon}`;
            locationItem.querySelector('span:last-child').classList.remove('loading');
            addItem(locationList, "Posizione attuale", `${lat}, ${lon}`, 'location');
          },
          error => {
            locationItem.querySelector('span:last-child').textContent = "Permesso negato";
            locationItem.querySelector('span:last-child').classList.remove('loading');
          },
          { timeout: 5000 }
        );
      } else {
        addItem(locationList, "Geolocalizzazione", "Non supportata", 'location');
      }
      
      // Fuso orario
      addItem(locationList, "Fuso orario", Intl.DateTimeFormat().resolvedOptions().timeZone, 'location');
    }

    function getBatteryInfo() {
      const batteryList = createSection("BATTERIA", "batteryList");
      
      if (!navigator.getBattery) {
        addItem(batteryList, "Stato batteria", "API non supportata", 'battery');
        return;
      }
      
      const batteryItem = addLoadingItem(batteryList, "Stato batteria");
      navigator.getBattery().then(battery => {
        const level = Math.round(battery.level * 100);
        batteryItem.querySelector('span:last-child').textContent = `${level}% ${battery.charging ? "âš¡" : "ðŸ”‹"}`;
        batteryItem.querySelector('span:last-child').classList.remove('loading');
        addItem(batteryList, "Stato batteria", `${level}% ${battery.charging ? "âš¡" : "ðŸ”‹"}`, 'battery');
        
        // Tempo di ricarica/scarica
        if (battery.charging && battery.chargingTime !== Infinity) {
          const hours = Math.floor(battery.chargingTime / 3600);
          const minutes = Math.floor((battery.chargingTime % 3600) / 60);
          addItem(batteryList, "Tempo alla carica completa", `${hours}h ${minutes}m`, 'battery');
        } else if (!battery.charging && battery.dischargingTime !== Infinity) {
          const hours = Math.floor(battery.dischargingTime / 3600);
          const minutes = Math.floor((battery.dischargingTime % 3600) / 60);
          addItem(batteryList, "Tempo alla scarica completa", `${hours}h ${minutes}m`, 'battery');
        }
      }).catch(() => {
        batteryItem.querySelector('span:last-child').textContent = "Errore nel rilevamento";
        batteryItem.querySelector('span:last-child').classList.remove('loading');
      });
    }

    // Avvio
    getSystemInfo();
    getNetworkInfo();
    getMediaInfo();
    getStorageInfo();
    getLocationInfo();
    getBatteryInfo();
  </script>
</body>
</html>