<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pong - YHAZ</title>
<link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#000; --fg:#fff; --muted:#888; --accent:#fff;
    --danger:#ff4d4d; --ok:#5cff5c;
  }
  *{box-sizing:border-box}
  html,body{height:100%; margin:0; background:var(--bg); color:var(--fg); font-family:'VT323',monospace;}
  body{display:flex; flex-direction:column;}
  header{display:flex; align-items:center; justify-content:center; padding:6px; position:relative;}
  .home-btn{position:absolute; left:12px; background:none; border:none; color:var(--fg); font-family:'VT323'; font-size:16px; cursor:pointer; padding:4px 8px; border-radius:4px;}
  .home-btn:hover{background:rgba(255,255,255,0.1);}
  h1{margin:0; font-size:32px; text-shadow:0 0 6px #fff;}
  .kbd{color:var(--muted); font-size:12px; margin-top:2px;}
  .game-container{flex:1; display:flex; flex-direction:column; justify-content:center; align-items:center; padding:4px; width:100%;}
  .canvas-wrapper{display:flex; justify-content:center; align-items:center; width:100%; max-width:400px; aspect-ratio:3/5; margin:0 auto;}
  canvas{background:#000; border:1px solid rgba(255,255,255,0.08); width:100%; height:100%; display:block;}
  .info{display:flex; gap:12px; justify-content:center; font-size:14px; margin:8px 0;}
  .controls{display:flex; gap:6px; justify-content:center; flex-wrap:wrap; margin:6px 0; width:100%; max-width:400px;}
  .btn{flex:1; min-width:60px; border:1px solid var(--fg); padding:12px 0; background:transparent; color:var(--fg); cursor:pointer; font-family:'VT323'; text-transform:uppercase; font-size:16px; border-radius:8px; max-width:120px;}
  .btn:hover{background:var(--fg); color:var(--bg);}
  .touch-controls{display:flex; gap:12px; justify-content:center; margin:8px 0;}
  .touch-btn{width:80px; height:80px; border:2px solid var(--fg); background:rgba(255,255,255,0.1); color:var(--fg); border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:24px; cursor:pointer; user-select:none; touch-action:none;}
  .touch-btn:active{background:rgba(255,255,255,0.3);}
  .score{font-size:28px; margin:8px 0; text-align:center;}
  footer{text-align:center; color:var(--muted); font-size:12px; padding:6px;}

  /* Miglioramenti per desktop */
  @media (min-width: 768px) {
    .btn{max-width:140px; padding:14px 0; font-size:18px;}
    .touch-btn{width:100px; height:100px; font-size:28px;}
    h1{font-size:36px;}
    .score{font-size:32px;}
  }

  /* Miglioramenti per mobile */
  @media (max-width: 480px) {
    .game-container{padding:2px;}
    .canvas-wrapper{max-width:100%; margin:0 8px; aspect-ratio:2/3;}
    .controls{gap:4px; padding:0 8px;}
    .btn{min-width:50px; font-size:14px; padding:10px 0;}
    .touch-btn{width:70px; height:70px; font-size:20px;}
    h1{font-size:28px;}
    .score{font-size:24px;}
  }
</style>
</head>
<body>
  <header>
    <button class="home-btn" id="homeBtn">HOME</button>
    <div style="text-align:center;">
      <h1>YHAZ PONG</h1>
      <div class="kbd">← → frecce per muovere • Touch su mobile</div>
    </div>
  </header>

  <div class="game-container">
    <div class="canvas-wrapper">
      <canvas id="pongCanvas" width="300" height="500"></canvas>
    </div>

    <div class="score" id="score">0 - 0</div>

    <div class="touch-controls">
      <div class="touch-btn" id="leftBtn">◀</div>
      <div class="touch-btn" id="rightBtn">▶</div>
    </div>

    <div class="controls">
      <button class="btn" id="startBtn">Start</button>
      <button class="btn" id="pauseBtn">Pause</button>
      <button class="btn" id="restartBtn">Restart</button>
      <button class="btn" id="soundBtn">Sound: On</button>
    </div>
  </div>

  <footer>© 2025 YHAZ — Pong • VT323 look</footer>

<script>
(() => {
  const canvas = document.getElementById('pongCanvas');
  const ctx = canvas.getContext('2d');
  const scoreEl = document.getElementById('score');
  const startBtn = document.getElementById('startBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const restartBtn = document.getElementById('restartBtn');
  const soundBtn = document.getElementById('soundBtn');
  const homeBtn = document.getElementById('homeBtn');
  const leftBtn = document.getElementById('leftBtn');
  const rightBtn = document.getElementById('rightBtn');

  // Game constants
  const paddleWidth = 60, paddleHeight = 10, ballSize = 10;
  let playerX = canvas.width/2 - paddleWidth/2;
  let botX = canvas.width/2 - paddleWidth/2;
  let ballX = canvas.width/2, ballY = canvas.height/2;
  let ballSpeedX = 3, ballSpeedY = 3;
  let playerSpeed = 0, botSpeed = 3;
  let playerScore = 0, botScore = 0;
  let running = false, paused = false;
  let soundOn = true;

  // Audio
  const AudioCtx = window.AudioContext || window.webkitAudioContext;
  const audioCtx = AudioCtx ? new AudioCtx() : null;
  
  function beep(freq=440, dur=0.06, vol=0.07){
    if(!audioCtx || !soundOn) return; 
    const o = audioCtx.createOscillator(); 
    const g = audioCtx.createGain(); 
    o.type='square'; 
    o.frequency.value = freq; 
    g.gain.value = vol; 
    o.connect(g); 
    g.connect(audioCtx.destination); 
    o.start(); 
    g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur); 
    setTimeout(()=> o.stop(), dur*1000 + 20);
  }

  // Drawing functions
  function drawRect(x, y, w, h, color){ 
    ctx.fillStyle = color; 
    ctx.fillRect(x, y, w, h); 
  }

  function drawBall(x, y, size, color){ 
    ctx.fillStyle = color; 
    ctx.beginPath(); 
    ctx.arc(x, y, size/2, 0, Math.PI*2); 
    ctx.fill(); 
  }

  function drawCenterLine(){
    ctx.strokeStyle = 'rgba(255,255,255,0.2)';
    ctx.setLineDash([5, 15]);
    ctx.beginPath();
    ctx.moveTo(canvas.width/2, 0);
    ctx.lineTo(canvas.width/2, canvas.height);
    ctx.stroke();
    ctx.setLineDash([]);
  }

  function draw(){
    // Clear canvas
    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Draw center line
    drawCenterLine();

    // Draw paddles and ball
    drawRect(playerX, canvas.height - 20, paddleWidth, paddleHeight, '#fff');
    drawRect(botX, 10, paddleWidth, paddleHeight, '#fff');
    drawBall(ballX, ballY, ballSize, '#fff');

    if(!paused && running){
      // Move ball
      ballX += ballSpeedX;
      ballY += ballSpeedY;

      // Wall collision
      if(ballX <= 0 || ballX >= canvas.width) {
        ballSpeedX = -ballSpeedX;
        beep(1200, 0.03, 0.05);
      }

      // Player paddle collision
      if(ballY + ballSize/2 >= canvas.height - 20 && 
         ballX >= playerX && ballX <= playerX + paddleWidth) {
        ballSpeedY = -ballSpeedY;
        // Add some angle based on where the ball hits the paddle
        let hitPos = (ballX - (playerX + paddleWidth/2)) / (paddleWidth/2);
        ballSpeedX = hitPos * 4;
        beep(800, 0.03, 0.06);
      }

      // Bot paddle collision
      if(ballY - ballSize/2 <= 20 && 
         ballX >= botX && ballX <= botX + paddleWidth) {
        ballSpeedY = -ballSpeedY;
        beep(800, 0.03, 0.06);
      }

      // Score points
      if(ballY > canvas.height){ 
        botScore++; 
        beep(200, 0.1, 0.1);
        resetBall(); 
      }
      if(ballY < 0){ 
        playerScore++; 
        beep(1000, 0.1, 0.1);
        resetBall(); 
      }

      // Move player paddle
      playerX += playerSpeed;
      if(playerX < 0) playerX = 0;
      if(playerX + paddleWidth > canvas.width) playerX = canvas.width - paddleWidth;

      // Bot AI
      if(ballSpeedY < 0){
        if(botX + paddleWidth/2 < ballX - 10) botX += botSpeed;
        else if(botX + paddleWidth/2 > ballX + 10) botX -= botSpeed;
      }
      if(botX < 0) botX = 0;
      if(botX + paddleWidth > canvas.width) botX = canvas.width - paddleWidth;

      // Increase difficulty over time
      if((playerScore + botScore) % 5 === 0 && (playerScore + botScore) > 0) {
        botSpeed = 3 + Math.floor((playerScore + botScore) / 5) * 0.5;
        ballSpeedX *= 1.02;
        ballSpeedY *= 1.02;
      }
    }

    // Update score display
    scoreEl.textContent = `${playerScore} - ${botScore}`;
  }

  // Reset ball
  function resetBall(){
    ballX = canvas.width/2;
    ballY = canvas.height/2;
    ballSpeedY = -ballSpeedY;
    ballSpeedX = (Math.random() * 4 - 2) || 3; // Random direction but not too slow
  }

  // Initialize game
  function init(){
    playerScore = 0;
    botScore = 0;
    playerX = canvas.width/2 - paddleWidth/2;
    botX = canvas.width/2 - paddleWidth/2;
    resetBall();
    botSpeed = 3;
    ballSpeedX = 3;
    ballSpeedY = 3;
    paused = false;
    updateUI();
  }

  function updateUI(){
    scoreEl.textContent = `${playerScore} - ${botScore}`;
  }

  // Touch controls
  leftBtn.addEventListener('pointerdown', () => { playerSpeed = -6; });
  leftBtn.addEventListener('pointerup', () => { playerSpeed = 0; });
  leftBtn.addEventListener('pointerleave', () => { playerSpeed = 0; });

  rightBtn.addEventListener('pointerdown', () => { playerSpeed = 6; });
  rightBtn.addEventListener('pointerup', () => { playerSpeed = 0; });
  rightBtn.addEventListener('pointerleave', () => { playerSpeed = 0; });

  // Keyboard controls
  window.addEventListener('keydown', (e) => {
    if(e.key === 'ArrowLeft') playerSpeed = -6;
    if(e.key === 'ArrowRight') playerSpeed = 6;
    if(e.key === ' ') { // Space to pause
      e.preventDefault();
      paused = !paused;
    }
  });

  window.addEventListener('keyup', (e) => {
    if(e.key === 'ArrowLeft' || e.key === 'ArrowRight') playerSpeed = 0;
  });

  // Button handlers
  startBtn.addEventListener('click', () => {
    if(!running){
      running = true;
      paused = false;
      gameLoop();
    }
  });

  pauseBtn.addEventListener('click', () => {
    if(running) paused = !paused;
  });

  restartBtn.addEventListener('click', () => {
    init();
    if(!running){
      running = true;
      gameLoop();
    }
  });

  soundBtn.addEventListener('click', () => {
    soundOn = !soundOn;
    soundBtn.textContent = 'Sound: ' + (soundOn ? 'On' : 'Off');
    if(soundOn && audioCtx && audioCtx.state === 'suspended') {
      audioCtx.resume();
    }
  });

  homeBtn.addEventListener('click', () => {
    if(confirm('Tornare alla home? Il gioco in corso verrà interrotto.')){
      window.location.href = '/';
    }
  });

  // Main game loop
  function gameLoop(){
    draw();
    if(running) requestAnimationFrame(gameLoop);
  }

  // Responsive scaling
  function scaleCanvas(){
    const parent = canvas.parentElement;
    const maxW = Math.min(window.innerWidth * 0.9, 400);
    parent.style.width = maxW + 'px';
    parent.style.height = (maxW * 1.67) + 'px'; // 3:5 aspect ratio
  }

  window.addEventListener('resize', scaleCanvas);
  scaleCanvas();

  // Initialize
  init();
  draw();
})();
</script>
</body>
</html>